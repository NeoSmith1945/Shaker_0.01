<!DOCTYPE html>
<html><head><title>Shaker Controller</title>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
</head>
<body>
<style>body { text-align: center; font-family: "Trebuchet MS", Arial; margin-left:auto; margin-right:auto;}
        .slider { width: 60%; height: 15px; cursor: pointer; box-shadow: 3px 3px 1p #000000, 1px 1px 1px #0d0d0d; background #3071a9; border-radius: 5px;
  border: 3px solid #010101; }
  .button { height:40px; width:20%}
</style>

<h1>Shaker Controller</h1>
<h2>Let's shake the baby carriage</h2>
<form>
  <p>Select Range for Shaker:</p>
  <div>
    <input type='radio' id='MOD_0' name='operation_mode'><label for='MOD_0'>Low</label>
    <input type='radio' id='MOD_1' name='operation_mode'><label for='MOD_1'>Mid</label>
    <input type='radio' id='MOD_2' name='operation_mode'><label for='MOD_2'>High</label>
  </div>
</form>
<br>Set servo intensity level: <span id='SPEED_VALUE'>-</span> <br>
<input type='range' min='10' max='40' value='25' class='slider' id='SERVO_INTENSITY'> <br>
<p>Duration (amount): <span id="AmountShow">-</span></p>
<input type="range" min="0" max="120" value='0' class="slider" id="shakeAmount" value="0"/>
<p>Or Duration (Minutes): <span id="DurationShow">-</span></p>
<input type="range" min="0" max="45" value='0' class="slider" id="shakeDuration" value="0"/>
<p>Supplay Voltage Cell/Total: <span id="servoPowerSupCelShow">-</span>V/<span id="servoPowerSupCelAllShow">-</span>V</p>
<p>Current Sensor 1/2: <span id="servoCurrentConsum1">-</span>A/<span id="servoCurrentConsum2">-</span>A</p>
<p>Position Sensor 1/2: <span id="servoCurrentPosition1">-</span>/<span id="servoCurrentPosition2">-</span></p>
<p><input type="submit" class="button" id="btnStart" value="START" />
<input type="submit" class="button" id="btnStop" value="STOP" /></p></span>
<p>Status: <span id="CurrentStatus">-</span></p>
<p>OTA off/on:<div> <input type='checkbox' id='OTA' name='ota_mode'></div></p>

</body>
<script>
  document.getElementById('MOD_0').addEventListener('click', mod_changed);
  document.getElementById('MOD_1').addEventListener('click', mod_changed);
  document.getElementById('MOD_2').addEventListener('click', mod_changed);
  document.getElementById('OTA').addEventListener('click', ota_checked);

  var slider = document.getElementById('SERVO_INTENSITY');
  var slider4 = document.getElementById("shakeAmount");
  var slider5 = document.getElementById("shakeDuration");
  var btnStop = document.getElementById("btnStop");
  var btnStart = document.getElementById("btnStart");

  var output = document.getElementById('SPEED_VALUE');
  var outAmountShow = document.getElementById('AmountShow');
  var outDurationShow = document.getElementById('DurationShow');
  var outServoPowerSupCelShow = document.getElementById('servoPowerSupCelShow');
  var outServoPowerSupCelAllShow = document.getElementById('servoPowerSupCelAllShow');
  var outServoCurrentConsum1 = document.getElementById('servoCurrentConsum1');
  var outServoCurrentConsum2 = document.getElementById('servoCurrentConsum2');
  var outCurrentStatus = document.getElementById('CurrentStatus');
  var outServoCurrentPos1 = document.getElementById('servoCurrentPosition1');
  var outServoCurrentPos2 = document.getElementById('servoCurrentPosition2');
  

  slider.addEventListener('click', sliderSevoIntensity_changed);
  slider4.addEventListener('click', sliderShakeAmount_changed);
  slider5.addEventListener('click', sliderShakeDuration_changed);
  btnStop.addEventListener('click', btnStop_changed);
  btnStart.addEventListener('click', btnStart_changed);



  var Socket;
  
  var Socket;
  var SocketOpen = false;

  function init() {
    Socket = new WebSocket('ws://' + window.location.hostname + ':81/');
    var msgOK = '[websockets] Connected to ws://' + window.location.hostname + ':81/';

    Socket.onmessage = function(event) {
      processCommand(event);
    };

    slider.setAttribute('disabled', true) ;
    slider4.setAttribute('disabled', true) ;
    slider5.setAttribute('disabled', true) ;
    btnStop.setAttribute('disabled', true) ;
    btnStart.setAttribute('disabled', true) ;

    document.getElementById('MOD_0').setAttribute('disabled', true) ;
    document.getElementById('MOD_1').setAttribute('disabled', true) ;
    document.getElementById('MOD_2').setAttribute('disabled', true) ;
    document.getElementById('OTA').setAttribute('disabled', true) ;

    Socket.addEventListener("open", () => {
      console.log(msgOK);
      SocketOpen = true;
      slider.removeAttribute('disabled');
      slider4.removeAttribute('disabled') ;
      slider5.removeAttribute('disabled') ;
      document.getElementById('MOD_0').removeAttribute('disabled') ;
      document.getElementById('MOD_1').removeAttribute('disabled') ;
      document.getElementById('MOD_2').removeAttribute('disabled') ;
      document.getElementById('OTA').removeAttribute('disabled') ;
    });
  }

  function ota_checked() {
	  var l_ota_selected = 0;
  	
    if(document.getElementById('OTA').checked == true) {
	      l_ota_selected = 1;
	  } else {
	      l_ota_selected = 0;
	  }
	  console.log(l_ota_selected);
    
    if (SocketOpen)  {
      var msg = { type: 'OTA_selected', value: l_ota_selected};
      Socket.send(JSON.stringify(msg));
    }
    else  	 
      console.log("Error: Socket is not open!!");
  }
   
  function mod_changed() {
	var l_MOD_selected = 0;
	if(document.getElementById('MOD_1').checked == true) {
	  l_MOD_selected = 1;
	} else if(document.getElementById('MOD_2').checked == true) {
	  l_MOD_selected = 2;
	}
	console.log(l_MOD_selected);
  if (SocketOpen)  {
    var msg = { type: 'MOD_selected', value: l_MOD_selected};
  	Socket.send(JSON.stringify(msg));
  }
    else  	 
      console.log("Error: Socket is not open!!");
  }
  
function sliderSevoIntensity_changed () {
  var l_SERVO_intensity = slider.value;
	console.log(l_SERVO_intensity);
	var msg = { type: 'SERVO_intensity', value: l_SERVO_intensity};
	Socket.send(JSON.stringify(msg)); 
}
  
function sliderShakeAmount_changed () {
  var l_SERVO_ShakeAmount = slider4.value;
	console.log(l_SERVO_ShakeAmount);
  btnStart.removeAttribute('disabled');
	var msg = { type: 'SERVO_SHAKE_AMOUNT', value: l_SERVO_ShakeAmount};
	Socket.send(JSON.stringify(msg));
}

function sliderShakeDuration_changed () {
  var l_SERVO_shakeDuration = slider5.value;
	console.log(l_SERVO_shakeDuration);
  btnStart.removeAttribute('disabled');
  var msg = { type: 'SERVO_SHAKE_DURATION', value: l_SERVO_shakeDuration};
	Socket.send(JSON.stringify(msg));
}

function btnStop_changed () {
	console.log("button Stop is clicked");
    btnStop.setAttribute('disabled', true);
    btnStart.removeAttribute('disabled') ;
    var msg = { type: 'SERVO_STOP', value: true};
    Socket.send(JSON.stringify(msg));
 }

function btnStart_changed () {
 	console.log("button Start is clkicked");
    btnStart.setAttribute('disabled', true);
    btnStop.removeAttribute('disabled') ;
    var msg = { type: 'SERVO_START', value: true};
	Socket.send(JSON.stringify(msg));
 }

function processCommand(event) {
	var obj = JSON.parse(event.data);
    var type = obj.type;
	if (type.localeCompare("SERVO_intensity") == 0) { 
	  var l_SERVO_intensity = parseInt(obj.value); 
	  console.log(l_SERVO_intensity); 
	  slider.value = l_SERVO_intensity; 
	  output.innerHTML = l_SERVO_intensity;
	}
	else if(type.localeCompare("MOD_selected") == 0) { 
	  var l_MOD_selected = parseInt(obj.value); 
	  console.log(l_MOD_selected); 
	  if(l_MOD_selected == 0) { 
	    document.getElementById('MOD_0').checked = true; 
      } else if (l_MOD_selected == 1) { 
	    document.getElementById('MOD_1').checked = true; 
	  } else if (l_MOD_selected == 2) { 
	    document.getElementById('MOD_2').checked = true; 
	  }
	}
  else if (type.localeCompare("SERVO_SHAKE_AMOUNT") == 0) { 
	  var l_SERVO_SHAKE_AMOUNT = parseInt(obj.value); 
	  console.log(l_SERVO_SHAKE_AMOUNT); 
	  slider4.value = l_SERVO_SHAKE_AMOUNT;
      outAmountShow.innerHTML = l_SERVO_SHAKE_AMOUNT; 
	}
  else if (type.localeCompare("SERVO_SHAKE_DURATION") == 0) { 
	  var l_SERVO_SHAKE_DURATION = parseInt(obj.value); 
	  console.log(l_SERVO_SHAKE_DURATION); 
	  slider5.value = l_SERVO_SHAKE_DURATION;
      outDurationShow.innerHTML = l_SERVO_SHAKE_DURATION; 
	}
  else if (type.localeCompare("SERVO_POWER_VOLTAGE_CELL") == 0) { 
	  var l_SERVO_VOLTAGE_CELL = obj.value; 
	  console.log(l_SERVO_VOLTAGE_CELL); 
	  outServoPowerSupCelShow.innerHTML = l_SERVO_VOLTAGE_CELL;
	}
  else if (type.localeCompare("SERVO_POWER_VOLTAGE_ALL") == 0) { 
	  var l_SERVO_POWER_VOLTAGE_ALL = obj.value; 
	  console.log(l_SERVO_POWER_VOLTAGE_ALL); 
      outServoPowerSupCelAllShow.innerHTML = l_SERVO_POWER_VOLTAGE_ALL;
	}
  else if (type.localeCompare("SERVO_ONE_MAX_CURRENT") == 0) { 
	  var l_SERVO_ONE_MAX_CURRENT = obj.value; 
	  console.log(l_SERVO_ONE_MAX_CURRENT); 
	  outServoCurrentConsum1.innerHTML = l_SERVO_ONE_MAX_CURRENT;
	}
  else if (type.localeCompare("SERVO_ONE_CURRENT_POS") == 0) { 
	  var l_SERVO_ONE_CURRENT_POS = obj.value; 
	  console.log(l_SERVO_ONE_CURRENT_POS); 
	  outServoCurrentPos1.innerHTML = l_SERVO_ONE_CURRENT_POS;
	}
  else if (type.localeCompare("SERVO_TWO_MAX_CURRENT") == 0) { 
	  var l_SERVO_TWO_MAX_CURRENT = obj.value; 
	  console.log(l_SERVO_TWO_MAX_CURRENT); 
      outServoCurrentConsum2.innerHTML = l_SERVO_TWO_MAX_CURRENT;
	}   
  else if (type.localeCompare("SERVO_TWO_CURRENT_POS") == 0) { 
	  var l_SERVO_TWO_CURRENT_POS = obj.value; 
	  console.log(l_SERVO_TWO_CURRENT_POS); 
      outServoCurrentPos2.innerHTML = l_SERVO_TWO_CURRENT_POS;
	}   
  else if (type.localeCompare("SERVO_CURENT_STATUS") == 0) { 
	  var l_SERVO_STATUS = obj.value; 
	  console.log(l_SERVO_STATUS); 
    outCurrentStatus.innerHTML = l_SERVO_STATUS;
	}   
  else if (type.localeCompare("DISABLE_START_BTN") == 0) { 
	  console.log("disable start btn"); 
    btnStart.setAttribute('disabled', true);
	}   
  else if (type.localeCompare("ENABLE_START_BTN") == 0) { 
	  console.log("enable start btn"); 
    btnStop.removeAttribute('disabled') ;
	}   
  else if (type.localeCompare("DISABLE_STOP_BTN") == 0) { 
	  console.log("disable start btn"); 
    btnStop.setAttribute('disabled', true);
	}   
  else if (type.localeCompare("ENABLE_STOP_BTN") == 0) { 
	  console.log("enable start btn"); 
    btnStop.removeAttribute('disabled') ;    
	}   
  else if (type.localeCompare("OTA_selected") == 0) {
    var l_OTA_STATUS = obj.value;
    if (l_OTA_STATUS == 1) { 
      console.log("ota enabled"); 
      document.getElementById('OTA').checked = true
    }
    else
      document.getElementById('OTA').checked = false
  }
}

window.onload = function(event) {
    init();
}
</script>
</html>